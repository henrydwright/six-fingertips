@page
@model IndexModel
@{
    ViewData["Title"] = "AI Assistant";
}

<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">
        <h1 class="nhsuk-heading-xl">AI Assistant</h1>
        
        @if (!ModelState.IsValid)
        {
            <div class="nhsuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1">
                <h2 class="nhsuk-error-summary__title" id="error-summary-title">
                    There is a problem
                </h2>
                <div class="nhsuk-error-summary__body">
                    <ul class="nhsuk-list nhsuk-error-summary__list">
                        @foreach (var modelError in ModelState.Values.SelectMany(v => v.Errors))
                        {
                            <li>
                                <a href="#input-text">@modelError.ErrorMessage</a>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        }

        <form method="post" id="questionForm">
            <div class="nhsuk-form-group @(ModelState["InputText"]?.Errors.Count > 0 ? "nhsuk-form-group--error" : "")">
                <label class="nhsuk-label" for="input-text">
                    Enter your question
                </label>
                <div class="nhsuk-hint" id="input-text-hint">
                    Type your question or request here
                </div>
                @if (ModelState["InputText"]?.Errors?.Count > 0)
                {
                    <span class="nhsuk-error-message" id="input-text-error">
                        <span class="nhsuk-u-visually-hidden">Error:</span> @ModelState["InputText"]?.Errors[0]?.ErrorMessage
                    </span>
                }
                <textarea 
                    class="nhsuk-textarea @(ModelState["InputText"]?.Errors.Count > 0 ? "nhsuk-textarea--error" : "")" 
                    id="input-text" 
                    name="InputText" 
                    rows="5" 
                    aria-describedby="input-text-hint @(ModelState["InputText"]?.Errors.Count > 0 ? "input-text-error" : "")"
                    asp-for="InputText"></textarea>
            </div>

            <button class="nhsuk-button" data-module="nhsuk-button" type="submit">
                Send
            </button>
        </form>

        <div id="loadingMessage" style="display: none;" class="nhsuk-card nhsuk-card--feature">
            <div class="nhsuk-card__content">
                <h2 class="nhsuk-card__heading nhsuk-heading-m">Processing your request</h2>
                <div class="nhsuk-card__description">
                    <p class="nhsuk-body">Please wait while we generate your response...</p>
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.AgentResponse))
        {
            <div class="nhsuk-card nhsuk-card--feature" id="responseCard">
                <div class="nhsuk-card__content">
                    <h2 class="nhsuk-card__heading nhsuk-heading-m">Response</h2>
                    <div class="nhsuk-card__description">
                        <p class="nhsuk-body">@Model.AgentResponse</p>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('questionForm');
        const loadingMessage = document.getElementById('loadingMessage');
        const responseCard = document.getElementById('responseCard');

        form.addEventListener('submit', function() {
            if (responseCard) {
                responseCard.style.display = 'none';
            }
            loadingMessage.style.display = 'block';
        });
    });
</script>
